"use strict";(self["webpackChunkbadminton_registration"]=self["webpackChunkbadminton_registration"]||[]).push([[218],{2218:function(a,e,t){t.r(e),t.d(e,{default:function(){return ma}});var l=t(6768),s=t(4232),i=t(5130);const n={class:"registration"},r={class:"container py-4"},o={key:0,class:"text-center py-5"},c={key:1,class:"alert alert-danger",role:"alert"},d={key:2},u={class:"card mb-4"},m={class:"card-body"},p={class:"row"},v={class:"col-md-8"},k={class:"col-md-4 text-md-end"},b={key:0,class:"alert alert-warning"},L={key:0,class:"mt-3"},g={key:0},y={key:0,class:"card"},f={class:"card-body"},h={class:"mb-4"},P={class:"row"},x={class:"col-md-4"},w={class:"form-group mb-3"},E={class:"col-md-4"},C={class:"form-group mb-3"},_={class:"col-md-4"},W={class:"form-group mb-3"},X={class:"mb-4"},R={class:"d-flex justify-content-between align-items-center mb-3"},V={key:0,class:"text-center py-3 border rounded"},S={class:"d-flex justify-content-between align-items-center mb-3"},U=["onClick"],K={class:"row"},D={class:"col-md-4"},J={class:"form-group mb-3"},q=["for"],A=["id","onUpdate:modelValue"],I={class:"col-md-4"},Q={class:"form-group mb-3"},M=["for"],j=["id","onUpdate:modelValue"],G={class:"col-md-4"},H={class:"form-group mb-3"},F=["for"],z=["id","onUpdate:modelValue"],O={class:"mb-4"},T={key:0,class:"alert alert-info"},Z={class:"mb-0"},$={key:0},B={class:"text-center"},N=["disabled"],Y={key:0,class:"text-danger mt-2"},aa={key:1,class:"text-danger mt-2"},ea={key:1,class:"alert alert-warning"},ta={key:1,class:"alert alert-info"};function la(a,e,t,la,sa,ia){const na=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("div",r,[la.loading?((0,l.uX)(),(0,l.CE)("div",o,e[6]||(e[6]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"載入場次資料...",-1)]))):la.error?((0,l.uX)(),(0,l.CE)("div",c,(0,s.v_)(la.error),1)):((0,l.uX)(),(0,l.CE)("div",d,[e[38]||(e[38]=(0,l.Lk)("h1",null,"報名表單",-1)),(0,l.Lk)("div",u,[e[23]||(e[23]=(0,l.Lk)("div",{class:"card-header bg-primary text-white"},[(0,l.Lk)("h5",{class:"mb-0"},"場次資訊")],-1)),(0,l.Lk)("div",m,[(0,l.Lk)("div",p,[(0,l.Lk)("div",v,[(0,l.Lk)("h2",null,(0,s.v_)(la.session.title),1),(0,l.Lk)("p",null,[e[7]||(e[7]=(0,l.Lk)("i",{class:"bi bi-calendar"},null,-1)),e[8]||(e[8]=(0,l.eW)()),e[9]||(e[9]=(0,l.Lk)("strong",null,"時間：",-1)),(0,l.eW)(" "+(0,s.v_)(la.formatDate(la.session.date)),1),e[10]||(e[10]=(0,l.Lk)("br",null,null,-1)),e[11]||(e[11]=(0,l.Lk)("i",{class:"bi bi-geo-alt"},null,-1)),e[12]||(e[12]=(0,l.eW)()),e[13]||(e[13]=(0,l.Lk)("strong",null,"地點：",-1)),(0,l.eW)(" "+(0,s.v_)(la.session.location),1),e[14]||(e[14]=(0,l.Lk)("br",null,null,-1)),e[15]||(e[15]=(0,l.Lk)("i",{class:"bi bi-people"},null,-1)),e[16]||(e[16]=(0,l.eW)()),e[17]||(e[17]=(0,l.Lk)("strong",null,"人數：",-1)),(0,l.eW)(" "+(0,s.v_)(la.session.currentParticipants)+"/"+(0,s.v_)(la.session.maxParticipants)+" 人",1),e[18]||(e[18]=(0,l.Lk)("br",null,null,-1)),e[19]||(e[19]=(0,l.Lk)("i",{class:"bi bi-currency-dollar"},null,-1)),e[20]||(e[20]=(0,l.eW)()),e[21]||(e[21]=(0,l.Lk)("strong",null,"費用：",-1)),(0,l.eW)(" "+(0,s.v_)(la.session.price)+" 元 ",1)])]),(0,l.Lk)("div",k,[la.canRegister?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",b,(0,s.v_)(la.registrationStatusMessage),1))])]),la.session.details?((0,l.uX)(),(0,l.CE)("div",L,[e[22]||(e[22]=(0,l.Lk)("h5",null,"詳細說明",-1)),(0,l.Lk)("p",null,(0,s.v_)(la.session.details),1)])):(0,l.Q3)("",!0)])]),la.currentUser?((0,l.uX)(),(0,l.CE)("div",g,[la.canRegister?((0,l.uX)(),(0,l.CE)("div",y,[e[34]||(e[34]=(0,l.Lk)("div",{class:"card-header bg-success text-white"},[(0,l.Lk)("h5",{class:"mb-0"},"填寫報名資料")],-1)),(0,l.Lk)("div",f,[(0,l.Lk)("form",{onSubmit:e[5]||(e[5]=(0,i.D$)(((...a)=>la.submitRegistration&&la.submitRegistration(...a)),["prevent"]))},[(0,l.Lk)("div",h,[e[27]||(e[27]=(0,l.Lk)("h5",null,"主要報名者",-1)),(0,l.Lk)("div",P,[(0,l.Lk)("div",x,[(0,l.Lk)("div",w,[e[24]||(e[24]=(0,l.Lk)("label",{for:"name",class:"form-label"},"姓名",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":e[0]||(e[0]=a=>la.primaryParticipant.name=a),required:""},null,512),[[i.Jo,la.primaryParticipant.name]])])]),(0,l.Lk)("div",E,[(0,l.Lk)("div",C,[e[25]||(e[25]=(0,l.Lk)("label",{for:"phone",class:"form-label"},"電話",-1)),(0,l.bo)((0,l.Lk)("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":e[1]||(e[1]=a=>la.primaryParticipant.phone=a),required:""},null,512),[[i.Jo,la.primaryParticipant.phone]])])]),(0,l.Lk)("div",_,[(0,l.Lk)("div",W,[e[26]||(e[26]=(0,l.Lk)("label",{for:"email",class:"form-label"},"電子郵件",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":e[2]||(e[2]=a=>la.primaryParticipant.email=a),required:""},null,512),[[i.Jo,la.primaryParticipant.email]])])])])]),(0,l.Lk)("div",X,[(0,l.Lk)("div",R,[e[29]||(e[29]=(0,l.Lk)("h5",null,"其他參加者",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:e[3]||(e[3]=(...a)=>la.addParticipant&&la.addParticipant(...a))},e[28]||(e[28]=[(0,l.Lk)("i",{class:"bi bi-plus"},null,-1),(0,l.eW)(" 新增參加者 ")]))]),0===la.additionalParticipants.length?((0,l.uX)(),(0,l.CE)("div",V,e[30]||(e[30]=[(0,l.Lk)("p",{class:"mb-0 text-muted"},"目前未添加其他參加者",-1)]))):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(la.additionalParticipants,((a,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"border rounded p-3 mb-3"},[(0,l.Lk)("div",S,[(0,l.Lk)("h6",null,"參加者 #"+(0,s.v_)(t+1),1),(0,l.Lk)("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:a=>la.removeParticipant(t)},e[31]||(e[31]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1),(0,l.eW)(" 移除 ")]),8,U)]),(0,l.Lk)("div",K,[(0,l.Lk)("div",D,[(0,l.Lk)("div",J,[(0,l.Lk)("label",{for:"additional-name-"+t,class:"form-label"},"姓名",8,q),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"additional-name-"+t,"onUpdate:modelValue":e=>a.name=e,required:""},null,8,A),[[i.Jo,a.name]])])]),(0,l.Lk)("div",I,[(0,l.Lk)("div",Q,[(0,l.Lk)("label",{for:"additional-phone-"+t,class:"form-label"},"電話",8,M),(0,l.bo)((0,l.Lk)("input",{type:"tel",class:"form-control",id:"additional-phone-"+t,"onUpdate:modelValue":e=>a.phone=e,required:""},null,8,j),[[i.Jo,a.phone]])])]),(0,l.Lk)("div",G,[(0,l.Lk)("div",H,[(0,l.Lk)("label",{for:"additional-email-"+t,class:"form-label"},"電子郵件",8,F),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control",id:"additional-email-"+t,"onUpdate:modelValue":e=>a.email=e,required:""},null,8,z),[[i.Jo,a.email]])])])])])))),128))]),(0,l.Lk)("div",O,[e[32]||(e[32]=(0,l.Lk)("label",{for:"notes",class:"form-label"},"備註",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[4]||(e[4]=a=>la.notes=a),rows:"3"},null,512),[[i.Jo,la.notes]])]),la.maxAllowed>0?((0,l.uX)(),(0,l.CE)("div",T,[(0,l.Lk)("p",Z,[e[33]||(e[33]=(0,l.Lk)("i",{class:"bi bi-info-circle"},null,-1)),(0,l.eW)(" 本場次每人最多可代表 "+(0,s.v_)(la.maxAllowed)+" 人報名 ",1),la.remainingSlots>0?((0,l.uX)(),(0,l.CE)("span",$,"（目前剩餘名額: "+(0,s.v_)(la.remainingSlots)+" 人）",1)):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",B,[(0,l.Lk)("button",{type:"submit",class:"btn btn-lg btn-success",disabled:la.submitLoading||la.totalParticipants>la.maxAllowed||la.totalParticipants>la.remainingSlots},(0,s.v_)(la.submitLoading?"處理中...":"確認報名"),9,N),la.totalParticipants>la.maxAllowed?((0,l.uX)(),(0,l.CE)("div",Y," 超過每人最多報名人數限制 ")):la.totalParticipants>la.remainingSlots?((0,l.uX)(),(0,l.CE)("div",aa," 超過剩餘名額 ")):(0,l.Q3)("",!0)])],32)])])):((0,l.uX)(),(0,l.CE)("div",ea,(0,s.v_)(la.registrationStatusMessage),1))])):((0,l.uX)(),(0,l.CE)("div",ta,[e[36]||(e[36]=(0,l.eW)(" 請先 ")),(0,l.bF)(na,{to:"/login",class:"alert-link"},{default:(0,l.k6)((()=>e[35]||(e[35]=[(0,l.eW)("登入")]))),_:1}),e[37]||(e[37]=(0,l.eW)(" 後再進行報名 "))]))]))])])}t(4114);var sa=t(144),ia=t(1387),na=t(7617),ra=t(3831),oa=t(1394),ca={name:"RegistrationView",setup(){const a=(0,ia.lq)(),e=(0,ia.rd)(),t=(0,sa.KR)(!0),s=(0,sa.KR)(null),i=(0,sa.KR)({}),n=(0,sa.KR)(null),r=(0,sa.KR)(!1),o=(0,sa.KR)({name:"",phone:"",email:""}),c=(0,sa.KR)([]),d=(0,sa.KR)(""),u=a.params.id;(0,l.sV)((()=>{m(),(0,ra.hg)(oa.j,(async a=>{if(a){n.value=a;const e=await(0,na.x7)((0,na.H9)(oa.db,"users",a.uid));if(e.exists()){const a=e.data();o.value={name:a.name||"",phone:a.phone||"",email:a.email||""}}v(a.uid)}}))}));const m=async()=>{try{const a=await(0,na.x7)((0,na.H9)(oa.db,"sessions",u));if(!a.exists())return s.value="找不到該場次資料",void(t.value=!1);i.value={id:a.id,...a.data(),date:a.data().date.toDate()}}catch(a){console.error("Error fetching session data:",a),s.value="無法載入場次資料，請稍後再試"}finally{t.value=!1}},p=(0,sa.KR)(!1),v=async a=>{try{const e=(0,na.P)((0,na.rJ)(oa.db,"registrations"),(0,na._M)("userId","==",a),(0,na._M)("sessionId","==",u)),t=await(0,na.GG)(e);t.empty||(p.value=!0)}catch(e){console.error("Error checking existing registration:",e)}},k=()=>{c.value.push({name:"",phone:"",email:""})},b=a=>{c.value.splice(a,1)},L=async()=>{r.value=!0;try{const a=[o.value,...c.value];await(0,na.gS)((0,na.rJ)(oa.db,"registrations"),{sessionId:u,userId:n.value.uid,participants:a,notes:d.value,paymentStatus:"未付款",timestamp:(0,na.O5)()});const t=(0,na.H9)(oa.db,"sessions",u);await(0,na.mZ)(t,{currentParticipants:(0,na.GV)(a.length)}),e.push({path:"/registration-success",query:{session:i.value.title,participants:a.length}})}catch(a){console.error("Error submitting registration:",a),alert("報名失敗，請稍後再試")}finally{r.value=!1}},g=(0,l.EW)((()=>5)),y=(0,l.EW)((()=>1+c.value.length)),f=(0,l.EW)((()=>i.value&&i.value.maxParticipants?i.value.maxParticipants-i.value.currentParticipants:0)),h=(0,l.EW)((()=>!(!i.value||!i.value.status)&&(!p.value&&("開放"===i.value.status&&(!(i.value.currentParticipants>=i.value.maxParticipants)&&!(new Date(i.value.date)<new Date)))))),P=(0,l.EW)((()=>p.value?"您已報名此場次":i.value&&i.value.status?"開放"!==i.value.status?"此場次已關閉報名":i.value.currentParticipants>=i.value.maxParticipants?"此場次已額滿":new Date(i.value.date)<new Date?"此場次已過期":"":"無法取得場次資訊")),x=a=>new Date(a).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"long"});return{session:i,loading:t,error:s,currentUser:n,primaryParticipant:o,additionalParticipants:c,notes:d,submitLoading:r,maxAllowed:g,totalParticipants:y,remainingSlots:f,canRegister:h,registrationStatusMessage:P,addParticipant:k,removeParticipant:b,submitRegistration:L,formatDate:x}}},da=t(1241);const ua=(0,da.A)(ca,[["render",la],["__scopeId","data-v-9c467eaa"]]);var ma=ua}}]);
//# sourceMappingURL=218.88512e6c.js.map