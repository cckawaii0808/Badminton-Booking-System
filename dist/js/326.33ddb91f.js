"use strict";(self["webpackChunkbadminton_registration"]=self["webpackChunkbadminton_registration"]||[]).push([[326],{2326:function(e,a,t){t.r(a),t.d(a,{default:function(){return be}});var l=t(6768),s=t(4232),i=t(5130);const n={class:"dashboard"},o={class:"container py-4"},d={class:"row mb-4"},r={class:"col-12"},c={class:"lead"},u={class:"row mb-4"},k={class:"col-md-6 mb-4 mb-md-0"},m={class:"card h-100"},b={class:"card-body"},L={key:0,class:"text-center py-4"},p={key:1,class:"text-center py-4"},v={key:2},g={class:"mb-1"},h={class:"mt-2"},y=["onClick"],f=["onClick"],w={class:"col-md-6"},_={class:"card h-100"},D={class:"card-body"},C={key:0,class:"text-center py-4"},R={key:1,class:"text-center py-4"},E={key:2},x={class:"d-flex justify-content-between align-items-start"},W={class:"mb-1"},P={class:"mb-1"},X={class:"mt-2"},M={key:1,class:"badge bg-info"},F={class:"text-end mt-3"},K={class:"row"},S={class:"col-12"},I={class:"card"},V={class:"card-body"},G={class:"row"},H={class:"col-md-6"},J={class:"col-md-6 text-md-end"},U={class:"modal fade",id:"registrationDetailModal",tabindex:"-1","aria-labelledby":"registrationDetailModalLabel","aria-hidden":"true"},Q={class:"modal-dialog modal-lg"},q={class:"modal-content"},A={key:0,class:"modal-body"},B={class:"mb-4"},j={class:"table table-bordered"},N={key:0},Z={class:"mb-4"},$={class:"table table-bordered"},z={class:"modal fade",id:"editProfileModal",tabindex:"-1","aria-labelledby":"editProfileModalLabel","aria-hidden":"true"},T={class:"modal-dialog"},O={class:"modal-content"},Y={class:"modal-body"},ee={class:"mb-3"},ae={class:"mb-3"},te={class:"mb-3"},le={class:"modal-footer"},se=["disabled"];function ie(e,a,t,ie,ne,oe){const de=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("div",o,[(0,l.Lk)("div",d,[(0,l.Lk)("div",r,[a[6]||(a[6]=(0,l.Lk)("h1",null,"個人儀表板",-1)),(0,l.Lk)("p",c,"歡迎回來，"+(0,s.v_)(ie.userData.name||"用戶"),1)])]),(0,l.Lk)("div",u,[(0,l.Lk)("div",k,[(0,l.Lk)("div",m,[a[25]||(a[25]=(0,l.Lk)("div",{class:"card-header bg-primary text-white"},[(0,l.Lk)("h5",{class:"mb-0"},"我的報名")],-1)),(0,l.Lk)("div",b,[ie.loadingRegistrations?((0,l.uX)(),(0,l.CE)("div",L,a[7]||(a[7]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,l.Lk)("p",null,"載入報名記錄...",-1)]))):0===ie.registrations.length?((0,l.uX)(),(0,l.CE)("div",p,[a[9]||(a[9]=(0,l.Lk)("p",{class:"mb-3"},"您尚未報名任何場次",-1)),(0,l.bF)(de,{to:"/sessions",class:"btn btn-primary"},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.eW)("瀏覽開放場次")]))),_:1})])):((0,l.uX)(),(0,l.CE)("div",v,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ie.registrations,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"mb-3 pb-3 border-bottom"},[(0,l.Lk)("h5",null,(0,s.v_)(e.sessionData.title),1),(0,l.Lk)("p",g,[a[10]||(a[10]=(0,l.Lk)("i",{class:"bi bi-calendar me-1"},null,-1)),a[11]||(a[11]=(0,l.eW)()),a[12]||(a[12]=(0,l.Lk)("strong",null,"時間：",-1)),(0,l.eW)(" "+(0,s.v_)(ie.formatDate(e.sessionData.date)),1),a[13]||(a[13]=(0,l.Lk)("br",null,null,-1)),a[14]||(a[14]=(0,l.Lk)("i",{class:"bi bi-geo-alt me-1"},null,-1)),a[15]||(a[15]=(0,l.eW)()),a[16]||(a[16]=(0,l.Lk)("strong",null,"地點：",-1)),(0,l.eW)(" "+(0,s.v_)(e.sessionData.location),1),a[17]||(a[17]=(0,l.Lk)("br",null,null,-1)),a[18]||(a[18]=(0,l.Lk)("i",{class:"bi bi-people me-1"},null,-1)),a[19]||(a[19]=(0,l.eW)()),a[20]||(a[20]=(0,l.Lk)("strong",null,"參加者：",-1)),(0,l.eW)(" "+(0,s.v_)(e.participants.length)+" 人",1),a[21]||(a[21]=(0,l.Lk)("br",null,null,-1)),a[22]||(a[22]=(0,l.Lk)("i",{class:"bi bi-credit-card me-1"},null,-1)),a[23]||(a[23]=(0,l.eW)()),a[24]||(a[24]=(0,l.Lk)("strong",null,"繳費：",-1)),(0,l.Lk)("span",{class:(0,s.C4)("已付款"===e.paymentStatus?"text-success":"text-warning")},(0,s.v_)(e.paymentStatus),3)]),(0,l.Lk)("div",h,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-info me-2",onClick:a=>ie.viewRegistrationDetails(e)}," 詳情 ",8,y),ie.isUpcoming(e.sessionData.date)&&"已付款"!==e.paymentStatus?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:a=>ie.cancelRegistration(e.id,e.sessionId,e.participants.length)}," 取消報名 ",8,f)):(0,l.Q3)("",!0)])])))),128))]))])])]),(0,l.Lk)("div",w,[(0,l.Lk)("div",_,[a[45]||(a[45]=(0,l.Lk)("div",{class:"card-header bg-success text-white"},[(0,l.Lk)("h5",{class:"mb-0"},"近期場次")],-1)),(0,l.Lk)("div",D,[ie.loadingSessions?((0,l.uX)(),(0,l.CE)("div",C,a[26]||(a[26]=[(0,l.Lk)("div",{class:"spinner-border text-success",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,l.Lk)("p",null,"載入場次資料...",-1)]))):0===ie.upcomingSessions.length?((0,l.uX)(),(0,l.CE)("div",R,a[27]||(a[27]=[(0,l.Lk)("p",null,"目前沒有即將開放的場次",-1)]))):((0,l.uX)(),(0,l.CE)("div",E,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ie.upcomingSessions,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"mb-3 pb-3 border-bottom"},[(0,l.Lk)("div",x,[(0,l.Lk)("h5",W,(0,s.v_)(e.title),1),(0,l.Lk)("span",{class:(0,s.C4)(["badge","開放"===e.status?"bg-success":"bg-danger"])},(0,s.v_)(e.status),3)]),(0,l.Lk)("p",P,[a[28]||(a[28]=(0,l.Lk)("i",{class:"bi bi-calendar me-1"},null,-1)),a[29]||(a[29]=(0,l.eW)()),a[30]||(a[30]=(0,l.Lk)("strong",null,"時間：",-1)),(0,l.eW)(" "+(0,s.v_)(ie.formatDate(e.date)),1),a[31]||(a[31]=(0,l.Lk)("br",null,null,-1)),a[32]||(a[32]=(0,l.Lk)("i",{class:"bi bi-geo-alt me-1"},null,-1)),a[33]||(a[33]=(0,l.eW)()),a[34]||(a[34]=(0,l.Lk)("strong",null,"地點：",-1)),(0,l.eW)(" "+(0,s.v_)(e.location),1),a[35]||(a[35]=(0,l.Lk)("br",null,null,-1)),a[36]||(a[36]=(0,l.Lk)("i",{class:"bi bi-people me-1"},null,-1)),a[37]||(a[37]=(0,l.eW)()),a[38]||(a[38]=(0,l.Lk)("strong",null,"人數：",-1)),(0,l.eW)(" "+(0,s.v_)(e.currentParticipants)+"/"+(0,s.v_)(e.maxParticipants),1),a[39]||(a[39]=(0,l.Lk)("br",null,null,-1)),a[40]||(a[40]=(0,l.Lk)("i",{class:"bi bi-currency-dollar me-1"},null,-1)),a[41]||(a[41]=(0,l.eW)()),a[42]||(a[42]=(0,l.Lk)("strong",null,"費用：",-1)),(0,l.eW)(" "+(0,s.v_)(e.price)+" 元 ",1)]),(0,l.Lk)("div",X,["開放"===e.status&&e.currentParticipants<e.maxParticipants&&!ie.isRegistered(e.id)?((0,l.uX)(),(0,l.Wv)(de,{key:0,to:`/registration/${e.id}`,class:"btn btn-sm btn-primary"},{default:(0,l.k6)((()=>a[43]||(a[43]=[(0,l.eW)(" 立即報名 ")]))),_:2},1032,["to"])):ie.isRegistered(e.id)?((0,l.uX)(),(0,l.CE)("span",M,"已報名")):(0,l.Q3)("",!0)])])))),128)),(0,l.Lk)("div",F,[(0,l.bF)(de,{to:"/sessions",class:"btn btn-outline-success"},{default:(0,l.k6)((()=>a[44]||(a[44]=[(0,l.eW)("查看更多場次")]))),_:1})])]))])])])]),(0,l.Lk)("div",K,[(0,l.Lk)("div",S,[(0,l.Lk)("div",I,[a[49]||(a[49]=(0,l.Lk)("div",{class:"card-header bg-info text-white"},[(0,l.Lk)("h5",{class:"mb-0"},"個人資料")],-1)),(0,l.Lk)("div",V,[(0,l.Lk)("div",G,[(0,l.Lk)("div",H,[(0,l.Lk)("p",null,[a[46]||(a[46]=(0,l.Lk)("strong",null,"姓名：",-1)),(0,l.eW)(" "+(0,s.v_)(ie.userData.name||"未設定"),1)]),(0,l.Lk)("p",null,[a[47]||(a[47]=(0,l.Lk)("strong",null,"電子郵件：",-1)),(0,l.eW)(" "+(0,s.v_)(ie.userData.email||"未設定"),1)]),(0,l.Lk)("p",null,[a[48]||(a[48]=(0,l.Lk)("strong",null,"電話：",-1)),(0,l.eW)(" "+(0,s.v_)(ie.userData.phone||"未設定"),1)])]),(0,l.Lk)("div",J,[(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[0]||(a[0]=(...e)=>ie.editProfile&&ie.editProfile(...e))}," 編輯個人資料 ")])])])])])])]),(0,l.Lk)("div",U,[(0,l.Lk)("div",Q,[(0,l.Lk)("div",q,[a[58]||(a[58]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title",id:"registrationDetailModalLabel"},"報名詳情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ie.selectedRegistration?((0,l.uX)(),(0,l.CE)("div",A,[(0,l.Lk)("div",B,[a[56]||(a[56]=(0,l.Lk)("h5",null,"場次資訊",-1)),(0,l.Lk)("table",j,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[a[50]||(a[50]=(0,l.Lk)("th",{width:"120"},"場次名稱",-1)),(0,l.Lk)("td",null,(0,s.v_)(ie.selectedRegistration.sessionData?.title),1)]),(0,l.Lk)("tr",null,[a[51]||(a[51]=(0,l.Lk)("th",null,"時間",-1)),(0,l.Lk)("td",null,(0,s.v_)(ie.formatDate(ie.selectedRegistration.sessionData?.date)),1)]),(0,l.Lk)("tr",null,[a[52]||(a[52]=(0,l.Lk)("th",null,"地點",-1)),(0,l.Lk)("td",null,(0,s.v_)(ie.selectedRegistration.sessionData?.location),1)]),(0,l.Lk)("tr",null,[a[53]||(a[53]=(0,l.Lk)("th",null,"報名時間",-1)),(0,l.Lk)("td",null,(0,s.v_)(ie.formatDate(ie.selectedRegistration.timestamp)),1)]),(0,l.Lk)("tr",null,[a[54]||(a[54]=(0,l.Lk)("th",null,"付款狀態",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,s.C4)("已付款"===ie.selectedRegistration.paymentStatus?"badge bg-success":"badge bg-warning")},(0,s.v_)(ie.selectedRegistration.paymentStatus),3)])]),ie.selectedRegistration.notes?((0,l.uX)(),(0,l.CE)("tr",N,[a[55]||(a[55]=(0,l.Lk)("th",null,"備註",-1)),(0,l.Lk)("td",null,(0,s.v_)(ie.selectedRegistration.notes),1)])):(0,l.Q3)("",!0)])])]),(0,l.Lk)("div",Z,[(0,l.Lk)("h5",null,"參加者清單 (共 "+(0,s.v_)(ie.selectedRegistration.participants?.length)+" 人)",1),(0,l.Lk)("table",$,[a[57]||(a[57]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"#"),(0,l.Lk)("th",null,"姓名"),(0,l.Lk)("th",null,"電話"),(0,l.Lk)("th",null,"電子郵件")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ie.selectedRegistration.participants,((e,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:a},[(0,l.Lk)("td",null,(0,s.v_)(a+1),1),(0,l.Lk)("td",null,(0,s.v_)(e.name),1),(0,l.Lk)("td",null,(0,s.v_)(e.phone),1),(0,l.Lk)("td",null,(0,s.v_)(e.email),1)])))),128))])])])])):(0,l.Q3)("",!0),a[59]||(a[59]=(0,l.Lk)("div",{class:"modal-footer"},[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉")],-1))])])]),(0,l.Lk)("div",z,[(0,l.Lk)("div",T,[(0,l.Lk)("div",O,[a[65]||(a[65]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title",id:"editProfileModalLabel"},"編輯個人資料"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",Y,[(0,l.Lk)("form",{onSubmit:a[4]||(a[4]=(0,i.D$)(((...e)=>ie.updateProfile&&ie.updateProfile(...e)),["prevent"]))},[(0,l.Lk)("div",ee,[a[60]||(a[60]=(0,l.Lk)("label",{for:"profileName",class:"form-label"},"姓名",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"profileName","onUpdate:modelValue":a[1]||(a[1]=e=>ie.profileForm.name=e),required:""},null,512),[[i.Jo,ie.profileForm.name]])]),(0,l.Lk)("div",ae,[a[61]||(a[61]=(0,l.Lk)("label",{for:"profilePhone",class:"form-label"},"電話",-1)),(0,l.bo)((0,l.Lk)("input",{type:"tel",class:"form-control",id:"profilePhone","onUpdate:modelValue":a[2]||(a[2]=e=>ie.profileForm.phone=e),required:""},null,512),[[i.Jo,ie.profileForm.phone]])]),(0,l.Lk)("div",te,[a[62]||(a[62]=(0,l.Lk)("label",{for:"profileEmail",class:"form-label"},"電子郵件",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control",id:"profileEmail","onUpdate:modelValue":a[3]||(a[3]=e=>ie.profileForm.email=e),required:"",disabled:""},null,512),[[i.Jo,ie.profileForm.email]]),a[63]||(a[63]=(0,l.Lk)("div",{class:"form-text"},"電子郵件無法修改",-1))])],32)]),(0,l.Lk)("div",le,[a[64]||(a[64]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:a[5]||(a[5]=(...e)=>ie.updateProfile&&ie.updateProfile(...e)),disabled:ie.updating},(0,s.v_)(ie.updating?"儲存中...":"儲存變更"),9,se)])])])])])}t(4114),t(8111),t(2489),t(1701),t(3579);var ne=t(144),oe=t(7617),de=t(3831),re=t(1394),ce=t(1387),ue={name:"DashboardView",setup(){const e=(0,ce.rd)(),a=(0,ne.KR)({}),t=(0,ne.KR)([]),s=(0,ne.KR)([]),i=(0,ne.KR)(!0),n=(0,ne.KR)(!0),o=(0,ne.KR)(null),d=(0,ne.KR)(null),r=(0,ne.KR)(!1),c=(0,ne.KR)({name:"",phone:"",email:""});let u=null,k=null;(0,l.sV)((()=>{(0,de.hg)(re.j,(async a=>{a?(o.value=a,await m(a.uid),await b(a.uid),await L(),"undefined"!==typeof window&&window.bootstrap&&(u=new window.bootstrap.Modal(document.getElementById("registrationDetailModal")),k=new window.bootstrap.Modal(document.getElementById("editProfileModal")))):e.push("/login")}))}));const m=async e=>{try{const t=await(0,oe.x7)((0,oe.H9)(re.db,"users",e));t.exists()&&(a.value=t.data(),c.value={name:a.value.name||"",phone:a.value.phone||"",email:a.value.email||""})}catch(t){console.error("Error fetching user data:",t)}},b=async e=>{try{i.value=!0;const a=(0,oe.P)((0,oe.rJ)(re.db,"registrations"),(0,oe._M)("userId","==",e),(0,oe.My)("timestamp","desc")),l=await(0,oe.GG)(a),s=l.docs.map((e=>({id:e.id,...e.data(),timestamp:e.data().timestamp?.toDate()||new Date})));for(const e of s){const a=await(0,oe.x7)((0,oe.H9)(re.db,"sessions",e.sessionId));a.exists()&&(e.sessionData={id:a.id,...a.data(),date:a.data().date.toDate()})}t.value=s}catch(a){console.error("Error fetching registrations:",a)}finally{i.value=!1}},L=async()=>{try{n.value=!0;const e=new Date,a=(0,oe.P)((0,oe.rJ)(re.db,"sessions"),(0,oe._M)("date",">=",e),(0,oe.My)("date"),(0,oe.AB)(5)),t=await(0,oe.GG)(a);s.value=t.docs.map((e=>({id:e.id,...e.data(),date:e.data().date.toDate()})))}catch(e){console.error("Error fetching upcoming sessions:",e)}finally{n.value=!1}},p=e=>{d.value=e,u&&u.show()},v=async(e,a,l)=>{const s=confirm("確定要取消此報名嗎？");if(s)try{await(0,oe.kd)((0,oe.H9)(re.db,"registrations",e));const s=(0,oe.H9)(re.db,"sessions",a);await(0,oe.mZ)(s,{currentParticipants:(0,oe.GV)(-l)}),t.value=t.value.filter((a=>a.id!==e)),alert("報名已成功取消")}catch(i){console.error("Error canceling registration:",i),alert("取消報名失敗，請稍後再試")}},g=()=>{c.value={name:a.value.name||"",phone:a.value.phone||"",email:a.value.email||""},k&&k.show()},h=async()=>{if(c.value.name&&c.value.phone){r.value=!0;try{const e=(0,oe.H9)(re.db,"users",o.value.uid);await(0,oe.mZ)(e,{name:c.value.name,phone:c.value.phone,updatedAt:new Date}),a.value={...a.value,name:c.value.name,phone:c.value.phone},k&&k.hide(),alert("個人資料已更新")}catch(e){console.error("Error updating profile:",e),alert("更新個人資料失敗，請稍後再試")}finally{r.value=!1}}else alert("請填寫所有必填欄位")},y=e=>new Date(e)>new Date,f=e=>t.value.some((a=>a.sessionId===e)),w=e=>e?new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"long"}):"未知時間";return{userData:a,registrations:t,upcomingSessions:s,loadingRegistrations:i,loadingSessions:n,selectedRegistration:d,profileForm:c,updating:r,viewRegistrationDetails:p,cancelRegistration:v,editProfile:g,updateProfile:h,isUpcoming:y,isRegistered:f,formatDate:w}}},ke=t(1241);const me=(0,ke.A)(ue,[["render",ie],["__scopeId","data-v-4da5bcdb"]]);var be=me}}]);
//# sourceMappingURL=326.33ddb91f.js.map