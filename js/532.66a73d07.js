"use strict";(self["webpackChunkbadminton_registration"]=self["webpackChunkbadminton_registration"]||[]).push([[532],{7532:function(l,a,e){e.r(a),e.d(a,{default:function(){return D}});var s=e(6768),t=e(5130),r=e(4232);const i={class:"blacklist-management"},n={class:"container py-4"},d={class:"card mb-4"},o={class:"card-body"},c={class:"row mb-3"},u={class:"col-md-6"},k={class:"col-md-6"},m=["disabled"],b={class:"card"},v={class:"card-body"},L={key:0,class:"text-center py-4"},h={key:1,class:"text-center py-4"},y={key:2},p={class:"table-responsive"},f={class:"table table-striped"},g=["onClick"];function B(l,a,e,B,E,_){return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",n,[a[10]||(a[10]=(0,s.Lk)("h1",null,"黑名單管理",-1)),(0,s.Lk)("div",d,[a[5]||(a[5]=(0,s.Lk)("div",{class:"card-header bg-danger text-white"},[(0,s.Lk)("h5",{class:"mb-0"},"新增黑名單")],-1)),(0,s.Lk)("div",o,[(0,s.Lk)("form",{onSubmit:a[2]||(a[2]=(0,t.D$)(((...l)=>B.addToBlacklist&&B.addToBlacklist(...l)),["prevent"]))},[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[a[3]||(a[3]=(0,s.Lk)("label",{for:"userEmail",class:"form-label"},"使用者電子郵件",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email",class:"form-control",id:"userEmail","onUpdate:modelValue":a[0]||(a[0]=l=>B.blacklistForm.email=l),required:""},null,512),[[t.Jo,B.blacklistForm.email]])]),(0,s.Lk)("div",k,[a[4]||(a[4]=(0,s.Lk)("label",{for:"reason",class:"form-label"},"列入黑名單原因",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"reason","onUpdate:modelValue":a[1]||(a[1]=l=>B.blacklistForm.reason=l),required:""},null,512),[[t.Jo,B.blacklistForm.reason]])])]),(0,s.Lk)("button",{type:"submit",class:"btn btn-danger",disabled:B.loading},(0,r.v_)(B.loading?"處理中...":"新增至黑名單"),9,m)],32)])]),(0,s.Lk)("div",b,[a[9]||(a[9]=(0,s.Lk)("div",{class:"card-header bg-dark text-white"},[(0,s.Lk)("h5",{class:"mb-0"},"黑名單列表")],-1)),(0,s.Lk)("div",v,[B.loadingUsers?((0,s.uX)(),(0,s.CE)("div",L,a[6]||(a[6]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,s.Lk)("p",null,"載入黑名單用戶...",-1)]))):0===B.blacklistedUsers.length?((0,s.uX)(),(0,s.CE)("div",h,a[7]||(a[7]=[(0,s.Lk)("p",null,"目前沒有黑名單用戶",-1)]))):((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("div",p,[(0,s.Lk)("table",f,[a[8]||(a[8]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"用戶名稱"),(0,s.Lk)("th",null,"電子郵件"),(0,s.Lk)("th",null,"電話"),(0,s.Lk)("th",null,"黑名單原因"),(0,s.Lk)("th",null,"加入時間"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(B.blacklistedUsers,(l=>((0,s.uX)(),(0,s.CE)("tr",{key:l.id},[(0,s.Lk)("td",null,(0,r.v_)(l.name),1),(0,s.Lk)("td",null,(0,r.v_)(l.email),1),(0,s.Lk)("td",null,(0,r.v_)(l.phone),1),(0,s.Lk)("td",null,(0,r.v_)(l.blacklistReason),1),(0,s.Lk)("td",null,(0,r.v_)(B.formatDate(l.blacklistedAt)),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-sm btn-outline-success",onClick:a=>B.removeFromBlacklist(l.id)}," 移出黑名單 ",8,g)])])))),128))])])])]))])])])])}e(4114),e(8111),e(2489),e(1701);var E=e(144),_=e(7617),w=e(3831),C=e(1394),F=e(1387),x={name:"BlacklistManagement",setup(){const l=(0,F.rd)(),a=(0,E.KR)([]),e=(0,E.KR)(!1),t=(0,E.KR)(!0),r=(0,E.KR)(null),i=(0,E.KR)({email:"",reason:""});(0,s.sV)((()=>{(0,w.hg)(C.j2,(async a=>{if(a){r.value=a;const e=await(0,_.x7)((0,_.H9)(C.db,"users",a.uid));e.exists()&&"admin"===e.data().role?n():(alert("您沒有管理員權限"),l.push("/dashboard"))}else l.push("/login")}))}));const n=async()=>{try{const l=(0,_.P)((0,_.rJ)(C.db,"users"),(0,_._M)("isBlacklisted","==",!0),(0,_.My)("blacklistedAt","desc")),e=await(0,_.GG)(l);a.value=e.docs.map((l=>({id:l.id,...l.data()})))}catch(l){console.error("Error fetching blacklisted users:",l),alert("載入黑名單用戶失敗，請稍後再試")}finally{t.value=!1}},d=async()=>{e.value=!0;try{const l=(0,_.P)((0,_.rJ)(C.db,"users"),(0,_._M)("email","==",i.value.email)),a=await(0,_.GG)(l);if(a.empty)return alert("找不到此電子郵件對應的用戶"),void(e.value=!1);const s=a.docs[0];await(0,_.mZ)((0,_.H9)(C.db,"users",s.id),{isBlacklisted:!0,blacklistReason:i.value.reason,blacklistedAt:(0,_.O5)(),blacklistedBy:r.value.uid}),i.value={email:"",reason:""},n(),alert("用戶已成功添加至黑名單")}catch(l){console.error("Error adding to blacklist:",l),alert("操作失敗，請稍後再試")}finally{e.value=!1}},o=async l=>{const e=confirm("確定要將此用戶從黑名單中移除？");if(e)try{await(0,_.mZ)((0,_.H9)(C.db,"users",l),{isBlacklisted:!1,removedFromBlacklistAt:(0,_.O5)(),removedFromBlacklistBy:r.value.uid}),a.value=a.value.filter((a=>a.id!==l)),alert("用戶已從黑名單中移除")}catch(s){console.error("Error removing from blacklist:",s),alert("操作失敗，請稍後再試")}},c=(0,s.EW)((()=>a.value.filter((l=>l.isBlacklisted)))),u=l=>{if(!l)return"未知時間";const a=l.toDate?l.toDate():new Date(l);return a.toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})};return{users:a,loading:e,loadingUsers:t,blacklistForm:i,blacklistedUsers:c,addToBlacklist:d,removeFromBlacklist:o,formatDate:u}}},R=e(1241);const U=(0,R.A)(x,[["render",B],["__scopeId","data-v-6a7d534e"]]);var D=U}}]);
//# sourceMappingURL=532.66a73d07.js.map