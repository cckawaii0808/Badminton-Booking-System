{"version":3,"file":"js/532.66a73d07.js","mappings":"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","sources":["webpack://badminton-registration/./src/views/admin/BlacklistManagement.vue","webpack://badminton-registration/./src/views/admin/BlacklistManagement.vue?9580"],"sourcesContent":["<template>\r\n  <div class=\"blacklist-management\">\r\n    <div class=\"container py-4\">\r\n      <h1>黑名單管理</h1>\r\n      \r\n      <!-- 新增黑名單 -->\r\n      <div class=\"card mb-4\">\r\n        <div class=\"card-header bg-danger text-white\">\r\n          <h5 class=\"mb-0\">新增黑名單</h5>\r\n        </div>\r\n        <div class=\"card-body\">\r\n          <form @submit.prevent=\"addToBlacklist\">\r\n            <div class=\"row mb-3\">\r\n              <div class=\"col-md-6\">\r\n                <label for=\"userEmail\" class=\"form-label\">使用者電子郵件</label>\r\n                <input type=\"email\" class=\"form-control\" id=\"userEmail\" v-model=\"blacklistForm.email\" required>\r\n              </div>\r\n              <div class=\"col-md-6\">\r\n                <label for=\"reason\" class=\"form-label\">列入黑名單原因</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"reason\" v-model=\"blacklistForm.reason\" required>\r\n              </div>\r\n            </div>\r\n            \r\n            <button type=\"submit\" class=\"btn btn-danger\" :disabled=\"loading\">\r\n              {{ loading ? '處理中...' : '新增至黑名單' }}\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 黑名單列表 -->\r\n      <div class=\"card\">\r\n        <div class=\"card-header bg-dark text-white\">\r\n          <h5 class=\"mb-0\">黑名單列表</h5>\r\n        </div>\r\n        <div class=\"card-body\">\r\n          <div v-if=\"loadingUsers\" class=\"text-center py-4\">\r\n            <div class=\"spinner-border text-primary\" role=\"status\">\r\n              <span class=\"visually-hidden\">載入中...</span>\r\n            </div>\r\n            <p>載入黑名單用戶...</p>\r\n          </div>\r\n          \r\n          <div v-else-if=\"blacklistedUsers.length === 0\" class=\"text-center py-4\">\r\n            <p>目前沒有黑名單用戶</p>\r\n          </div>\r\n          \r\n          <div v-else>\r\n            <div class=\"table-responsive\">\r\n              <table class=\"table table-striped\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>用戶名稱</th>\r\n                    <th>電子郵件</th>\r\n                    <th>電話</th>\r\n                    <th>黑名單原因</th>\r\n                    <th>加入時間</th>\r\n                    <th>操作</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  <tr v-for=\"user in blacklistedUsers\" :key=\"user.id\">\r\n                    <td>{{ user.name }}</td>\r\n                    <td>{{ user.email }}</td>\r\n                    <td>{{ user.phone }}</td>\r\n                    <td>{{ user.blacklistReason }}</td>\r\n                    <td>{{ formatDate(user.blacklistedAt) }}</td>\r\n                    <td>\r\n                      <button \r\n                        class=\"btn btn-sm btn-outline-success\" \r\n                        @click=\"removeFromBlacklist(user.id)\"\r\n                      >\r\n                        移出黑名單\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, computed } from 'vue';\r\nimport { \r\n  collection, \r\n  query, \r\n  where, \r\n  getDocs, \r\n  getDoc, \r\n  doc, \r\n  updateDoc, \r\n  serverTimestamp, \r\n  orderBy \r\n} from 'firebase/firestore';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport { db, auth } from '@/firebase';\r\nimport { useRouter } from 'vue-router';\r\n\r\nexport default {\r\n  name: 'BlacklistManagement',\r\n  setup() {\r\n    const router = useRouter();\r\n    const users = ref([]);\r\n    const loading = ref(false);\r\n    const loadingUsers = ref(true);\r\n    const currentUser = ref(null);\r\n    \r\n    const blacklistForm = ref({\r\n      email: '',\r\n      reason: ''\r\n    });\r\n    \r\n    onMounted(() => {\r\n      // 檢查用戶權限\r\n      onAuthStateChanged(auth, async (user) => {\r\n        if (user) {\r\n          currentUser.value = user;\r\n          // 檢查是否為管理員\r\n          const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n          if (userDoc.exists() && userDoc.data().role === 'admin') {\r\n            // 獲取黑名單用戶\r\n            fetchBlacklistedUsers();\r\n          } else {\r\n            // 非管理員導回儀表板\r\n            alert('您沒有管理員權限');\r\n            router.push('/dashboard');\r\n          }\r\n        } else {\r\n          router.push('/login');\r\n        }\r\n      });\r\n    });\r\n    \r\n    const fetchBlacklistedUsers = async () => {\r\n      try {\r\n        const usersQuery = query(\r\n          collection(db, 'users'),\r\n          where('isBlacklisted', '==', true),\r\n          orderBy('blacklistedAt', 'desc')\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(usersQuery);\r\n        users.value = querySnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n      } catch (e) {\r\n        console.error('Error fetching blacklisted users:', e);\r\n        alert('載入黑名單用戶失敗，請稍後再試');\r\n      } finally {\r\n        loadingUsers.value = false;\r\n      }\r\n    };\r\n    \r\n    const addToBlacklist = async () => {\r\n      loading.value = true;\r\n      \r\n      try {\r\n        // 查找用戶\r\n        const usersQuery = query(\r\n          collection(db, 'users'),\r\n          where('email', '==', blacklistForm.value.email)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(usersQuery);\r\n        \r\n        if (querySnapshot.empty) {\r\n          alert('找不到此電子郵件對應的用戶');\r\n          loading.value = false;\r\n          return;\r\n        }\r\n        \r\n        // 更新用戶的黑名單狀態\r\n        const userDoc = querySnapshot.docs[0];\r\n        await updateDoc(doc(db, 'users', userDoc.id), {\r\n          isBlacklisted: true,\r\n          blacklistReason: blacklistForm.value.reason,\r\n          blacklistedAt: serverTimestamp(),\r\n          blacklistedBy: currentUser.value.uid\r\n        });\r\n        \r\n        // 重置表單\r\n        blacklistForm.value = {\r\n          email: '',\r\n          reason: ''\r\n        };\r\n        \r\n        // 重新獲取黑名單用戶\r\n        fetchBlacklistedUsers();\r\n        \r\n        alert('用戶已成功添加至黑名單');\r\n      } catch (e) {\r\n        console.error('Error adding to blacklist:', e);\r\n        alert('操作失敗，請稍後再試');\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    };\r\n    \r\n    const removeFromBlacklist = async (userId) => {\r\n      const confirmRemove = confirm('確定要將此用戶從黑名單中移除？');\r\n      if (!confirmRemove) return;\r\n      \r\n      try {\r\n        await updateDoc(doc(db, 'users', userId), {\r\n          isBlacklisted: false,\r\n          removedFromBlacklistAt: serverTimestamp(),\r\n          removedFromBlacklistBy: currentUser.value.uid\r\n        });\r\n        \r\n        // 從列表中移除用戶\r\n        users.value = users.value.filter(u => u.id !== userId);\r\n        \r\n        alert('用戶已從黑名單中移除');\r\n      } catch (e) {\r\n        console.error('Error removing from blacklist:', e);\r\n        alert('操作失敗，請稍後再試');\r\n      }\r\n    };\r\n    \r\n    // 黑名單用戶列表\r\n    const blacklistedUsers = computed(() => {\r\n      return users.value.filter(u => u.isBlacklisted);\r\n    });\r\n    \r\n    const formatDate = (timestamp) => {\r\n      if (!timestamp) return '未知時間';\r\n      \r\n      // 處理Firestore Timestamp\r\n      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n      \r\n      return date.toLocaleString('zh-TW', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    };\r\n    \r\n    return {\r\n      users,\r\n      loading,\r\n      loadingUsers,\r\n      blacklistForm,\r\n      blacklistedUsers,\r\n      addToBlacklist,\r\n      removeFromBlacklist,\r\n      formatDate\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.blacklist-management {\r\n  padding-bottom: 2rem;\r\n}\r\n\r\n.card {\r\n  margin-bottom: 1.5rem;\r\n  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);\r\n}\r\n\r\n.badge {\r\n  font-size: 0.875rem;\r\n  padding: 0.35em 0.65em;\r\n}\r\n\r\n.btn-sm {\r\n  padding: 0.25rem 0.5rem;\r\n  font-size: 0.875rem;\r\n}\r\n</style>","import { render } from \"./BlacklistManagement.vue?vue&type=template&id=6a7d534e&scoped=true\"\nimport script from \"./BlacklistManagement.vue?vue&type=script&lang=js\"\nexport * from \"./BlacklistManagement.vue?vue&type=script&lang=js\"\n\nimport \"./BlacklistManagement.vue?vue&type=style&index=0&id=6a7d534e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-6a7d534e\"]])\n\nexport default __exports__"],"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","onSubmit","_cache","_withModifiers","args","$setup","addToBlacklist","_hoisted_5","_hoisted_6","for","type","id","$event","blacklistForm","email","required","_hoisted_7","reason","disabled","loading","_hoisted_8","_hoisted_9","_hoisted_10","loadingUsers","_hoisted_11","role","blacklistedUsers","length","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_Fragment","_renderList","user","_toDisplayString","name","phone","blacklistReason","formatDate","blacklistedAt","onClick","removeFromBlacklist","_hoisted_16","setup","router","useRouter","users","ref","currentUser","onMounted","onAuthStateChanged","auth","async","value","userDoc","getDoc","doc","db","uid","exists","data","fetchBlacklistedUsers","alert","push","usersQuery","query","collection","where","orderBy","querySnapshot","getDocs","docs","map","e","console","error","empty","updateDoc","isBlacklisted","serverTimestamp","blacklistedBy","confirmRemove","confirm","userId","removedFromBlacklistAt","removedFromBlacklistBy","filter","u","computed","timestamp","date","toDate","Date","toLocaleString","year","month","day","hour","minute","__exports__","render"],"sourceRoot":""}