"use strict";(self["webpackChunkbadminton_registration"]=self["webpackChunkbadminton_registration"]||[]).push([[94],{5094:function(e,t,a){a.r(t),a.d(t,{default:function(){return ae}});var s=a(6768),l=a(5130),i=a(4232);const o={class:"session-management"},n={class:"container py-4"},d={class:"card mb-4"},r={class:"card-body"},c={class:"row mb-3"},u={class:"col-md-6"},m={class:"col-md-6"},p={class:"row mb-3"},b={class:"col-md-6"},k={class:"col-md-6"},L={class:"row mb-3"},v={class:"col-md-6"},g={class:"col-md-6"},S={class:"mb-3"},f=["disabled"],y={class:"card"},w={class:"card-body"},h={key:0,class:"text-center py-4"},x={key:1,class:"text-center py-4"},P={key:2},D={class:"table-responsive"},C={class:"table table-striped"},V=["onClick"],J=["onClick"],U=["onClick"],_={class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-lg"},E={class:"modal-content"},M={class:"modal-body"},$={class:"row mb-3"},K={class:"col-md-6"},I={class:"col-md-6"},R={class:"row mb-3"},X={class:"col-md-6"},H={class:"col-md-6"},A={class:"row mb-3"},T={class:"col-md-6"},O={class:"col-md-6"},B={class:"mb-3"},F={class:"modal-footer"},G=["disabled"];function Z(e,t,a,Z,j,z){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",n,[t[30]||(t[30]=(0,s.Lk)("h1",null,"場次管理",-1)),(0,s.Lk)("div",d,[t[25]||(t[25]=(0,s.Lk)("div",{class:"card-header bg-primary text-white"},[(0,s.Lk)("h5",{class:"mb-0"},"新增場次")],-1)),(0,s.Lk)("div",r,[(0,s.Lk)("form",{onSubmit:t[7]||(t[7]=(0,l.D$)(((...e)=>Z.addSession&&Z.addSession(...e)),["prevent"]))},[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[t[17]||(t[17]=(0,s.Lk)("label",{for:"title",class:"form-label"},"場次名稱",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>Z.newSession.title=e),required:""},null,512),[[l.Jo,Z.newSession.title]])]),(0,s.Lk)("div",m,[t[18]||(t[18]=(0,s.Lk)("label",{for:"location",class:"form-label"},"地點",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"location","onUpdate:modelValue":t[1]||(t[1]=e=>Z.newSession.location=e),required:""},null,512),[[l.Jo,Z.newSession.location]])])]),(0,s.Lk)("div",p,[(0,s.Lk)("div",b,[t[19]||(t[19]=(0,s.Lk)("label",{for:"date",class:"form-label"},"日期時間",-1)),(0,s.bo)((0,s.Lk)("input",{type:"datetime-local",class:"form-control",id:"date","onUpdate:modelValue":t[2]||(t[2]=e=>Z.newSession.date=e),required:""},null,512),[[l.Jo,Z.newSession.date]])]),(0,s.Lk)("div",k,[t[20]||(t[20]=(0,s.Lk)("label",{for:"maxParticipants",class:"form-label"},"最大人數",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",id:"maxParticipants","onUpdate:modelValue":t[3]||(t[3]=e=>Z.newSession.maxParticipants=e),min:"1",required:""},null,512),[[l.Jo,Z.newSession.maxParticipants]])])]),(0,s.Lk)("div",L,[(0,s.Lk)("div",v,[t[21]||(t[21]=(0,s.Lk)("label",{for:"price",class:"form-label"},"費用",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[4]||(t[4]=e=>Z.newSession.price=e),min:"0",required:""},null,512),[[l.Jo,Z.newSession.price]])]),(0,s.Lk)("div",g,[t[23]||(t[23]=(0,s.Lk)("label",{for:"status",class:"form-label"},"狀態",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select",id:"status","onUpdate:modelValue":t[5]||(t[5]=e=>Z.newSession.status=e),required:""},t[22]||(t[22]=[(0,s.Lk)("option",{value:"開放"},"開放",-1),(0,s.Lk)("option",{value:"關閉"},"關閉",-1)]),512),[[l.u1,Z.newSession.status]])])]),(0,s.Lk)("div",S,[t[24]||(t[24]=(0,s.Lk)("label",{for:"details",class:"form-label"},"詳細說明",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"form-control",id:"details","onUpdate:modelValue":t[6]||(t[6]=e=>Z.newSession.details=e),rows:"3"},null,512),[[l.Jo,Z.newSession.details]])]),(0,s.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:Z.loading},(0,i.v_)(Z.loading?"處理中...":"新增場次"),9,f)],32)])]),(0,s.Lk)("div",y,[t[29]||(t[29]=(0,s.Lk)("div",{class:"card-header bg-secondary text-white"},[(0,s.Lk)("h5",{class:"mb-0"},"場次列表")],-1)),(0,s.Lk)("div",w,[Z.loadingSessions?((0,s.uX)(),(0,s.CE)("div",h,t[26]||(t[26]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,s.Lk)("p",null,"載入場次資料...",-1)]))):0===Z.sessions.length?((0,s.uX)(),(0,s.CE)("div",x,t[27]||(t[27]=[(0,s.Lk)("p",null,"暫無場次資料",-1)]))):((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("div",D,[(0,s.Lk)("table",C,[t[28]||(t[28]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"場次名稱"),(0,s.Lk)("th",null,"日期時間"),(0,s.Lk)("th",null,"地點"),(0,s.Lk)("th",null,"報名人數"),(0,s.Lk)("th",null,"費用"),(0,s.Lk)("th",null,"狀態"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.sessions,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,i.v_)(e.title),1),(0,s.Lk)("td",null,(0,i.v_)(Z.formatDate(e.date)),1),(0,s.Lk)("td",null,(0,i.v_)(e.location),1),(0,s.Lk)("td",null,(0,i.v_)(e.currentParticipants)+"/"+(0,i.v_)(e.maxParticipants),1),(0,s.Lk)("td",null,(0,i.v_)(e.price)+" 元",1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,i.C4)("開放"===e.status?"badge bg-success":"badge bg-danger")},(0,i.v_)(e.status),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:t=>Z.editSession(e)}," 編輯 ",8,V),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-warning me-1",onClick:t=>Z.toggleSessionStatus(e)},(0,i.v_)("開放"===e.status?"關閉":"開放"),9,J),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>Z.deleteSession(e.id)}," 刪除 ",8,U)])])))),128))])])])]))])])]),(0,s.Lk)("div",_,[(0,s.Lk)("div",q,[(0,s.Lk)("div",E,[t[40]||(t[40]=(0,s.Lk)("div",{class:"modal-header"},[(0,s.Lk)("h5",{class:"modal-title",id:"editSessionModalLabel"},"編輯場次"),(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,s.Lk)("div",M,[(0,s.Lk)("form",{onSubmit:t[15]||(t[15]=(0,l.D$)(((...e)=>Z.updateSession&&Z.updateSession(...e)),["prevent"]))},[(0,s.Lk)("div",$,[(0,s.Lk)("div",K,[t[31]||(t[31]=(0,s.Lk)("label",{for:"editTitle",class:"form-label"},"場次名稱",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"editTitle","onUpdate:modelValue":t[8]||(t[8]=e=>Z.editingSession.title=e),required:""},null,512),[[l.Jo,Z.editingSession.title]])]),(0,s.Lk)("div",I,[t[32]||(t[32]=(0,s.Lk)("label",{for:"editLocation",class:"form-label"},"地點",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"editLocation","onUpdate:modelValue":t[9]||(t[9]=e=>Z.editingSession.location=e),required:""},null,512),[[l.Jo,Z.editingSession.location]])])]),(0,s.Lk)("div",R,[(0,s.Lk)("div",X,[t[33]||(t[33]=(0,s.Lk)("label",{for:"editDate",class:"form-label"},"日期時間",-1)),(0,s.bo)((0,s.Lk)("input",{type:"datetime-local",class:"form-control",id:"editDate","onUpdate:modelValue":t[10]||(t[10]=e=>Z.editingSession.dateString=e),required:""},null,512),[[l.Jo,Z.editingSession.dateString]])]),(0,s.Lk)("div",H,[t[34]||(t[34]=(0,s.Lk)("label",{for:"editMaxParticipants",class:"form-label"},"最大人數",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",id:"editMaxParticipants","onUpdate:modelValue":t[11]||(t[11]=e=>Z.editingSession.maxParticipants=e),min:"1",required:""},null,512),[[l.Jo,Z.editingSession.maxParticipants]])])]),(0,s.Lk)("div",A,[(0,s.Lk)("div",T,[t[35]||(t[35]=(0,s.Lk)("label",{for:"editPrice",class:"form-label"},"費用",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",id:"editPrice","onUpdate:modelValue":t[12]||(t[12]=e=>Z.editingSession.price=e),min:"0",required:""},null,512),[[l.Jo,Z.editingSession.price]])]),(0,s.Lk)("div",O,[t[37]||(t[37]=(0,s.Lk)("label",{for:"editStatus",class:"form-label"},"狀態",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select",id:"editStatus","onUpdate:modelValue":t[13]||(t[13]=e=>Z.editingSession.status=e),required:""},t[36]||(t[36]=[(0,s.Lk)("option",{value:"開放"},"開放",-1),(0,s.Lk)("option",{value:"關閉"},"關閉",-1)]),512),[[l.u1,Z.editingSession.status]])])]),(0,s.Lk)("div",B,[t[38]||(t[38]=(0,s.Lk)("label",{for:"editDetails",class:"form-label"},"詳細說明",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"form-control",id:"editDetails","onUpdate:modelValue":t[14]||(t[14]=e=>Z.editingSession.details=e),rows:"3"},null,512),[[l.Jo,Z.editingSession.details]])])],32)]),(0,s.Lk)("div",F,[t[39]||(t[39]=(0,s.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[16]||(t[16]=(...e)=>Z.updateSession&&Z.updateSession(...e)),disabled:Z.updateLoading},(0,i.v_)(Z.updateLoading?"儲存中...":"儲存變更"),9,G)])])])])])}a(4114),a(8111),a(1701);var j=a(144),z=a(7617),W=a(3831),Y=a(1394),N=a(1387),Q={name:"SessionManagement",setup(){const e=(0,N.rd)(),t=(0,j.KR)([]),a=(0,j.KR)({title:"",location:"",date:"",maxParticipants:20,details:"",price:200,status:"開放"}),l=(0,j.KR)(!1),i=(0,j.KR)(!1),o=(0,j.KR)(!0),n=(0,j.KR)(null),d=(0,j.KR)({id:null,title:"",location:"",dateString:"",maxParticipants:0,details:"",price:0,status:"開放"});let r=null;(0,s.sV)((()=>{(0,W.hg)(Y.j2,(async t=>{if(t){n.value=t;const a=await(0,z.x7)((0,z.H9)(Y.db,"users",t.uid));a.exists()&&"admin"===a.data().role?c():(alert("您沒有管理員權限"),e.push("/dashboard"))}else e.push("/login")})),"undefined"!==typeof window&&window.bootstrap&&(r=new window.bootstrap.Modal(document.getElementById("editSessionModal")))}));const c=async()=>{try{o.value=!0;const e=(0,z.P)((0,z.rJ)(Y.db,"sessions"),(0,z.My)("date","desc")),a=await(0,z.GG)(e);t.value=a.docs.map((e=>({id:e.id,...e.data(),date:e.data().date.toDate()})))}catch(e){console.error("Error fetching sessions:",e),alert("載入場次資料失敗，請稍後再試")}finally{o.value=!1}},u=async()=>{if(a.value.date){l.value=!0;try{const e={title:a.value.title,location:a.value.location,date:z.Dc.fromDate(new Date(a.value.date)),maxParticipants:parseInt(a.value.maxParticipants),currentParticipants:0,details:a.value.details,price:parseInt(a.value.price),status:a.value.status,createdBy:n.value.uid,createdAt:(0,z.O5)()};await(0,z.gS)((0,z.rJ)(Y.db,"sessions"),e),a.value={title:"",location:"",date:"",maxParticipants:20,details:"",price:200,status:"開放"},c(),alert("場次新增成功！")}catch(e){console.error("Error adding session:",e),alert("新增場次失敗，請稍後再試")}finally{l.value=!1}}else alert("請選擇日期時間")},m=e=>{const t=new Date(e.date),a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");d.value={id:e.id,title:e.title,location:e.location,dateString:`${a}-${s}-${l}T${i}:${o}`,maxParticipants:e.maxParticipants,details:e.details||"",price:e.price,status:e.status,currentParticipants:e.currentParticipants},r&&r.show()},p=async()=>{if(d.value.dateString){i.value=!0;try{const e=(0,z.H9)(Y.db,"sessions",d.value.id);await(0,z.mZ)(e,{title:d.value.title,location:d.value.location,date:z.Dc.fromDate(new Date(d.value.dateString)),maxParticipants:parseInt(d.value.maxParticipants),details:d.value.details,price:parseInt(d.value.price),status:d.value.status,updatedAt:(0,z.O5)()}),r&&r.hide(),c(),alert("場次更新成功！")}catch(e){console.error("Error updating session:",e),alert("更新場次失敗，請稍後再試")}finally{i.value=!1}}else alert("請選擇日期時間")},b=async e=>{const t="開放"===e.status?"關閉":"開放",a=confirm(`確定將場次「${e.title}」狀態設為「${t}」?`);if(a)try{const a=(0,z.H9)(Y.db,"sessions",e.id);await(0,z.mZ)(a,{status:t,updatedAt:(0,z.O5)()}),c(),alert(`場次狀態已更新為「${t}」`)}catch(s){console.error("Error toggling session status:",s),alert("更新場次狀態失敗，請稍後再試")}},k=async e=>{const t=confirm("確定要刪除此場次？此操作無法還原！");if(t)try{await(0,z.kd)((0,z.H9)(Y.db,"sessions",e)),c(),alert("場次已刪除")}catch(a){console.error("Error deleting session:",a),alert("刪除場次失敗，請稍後再試")}},L=e=>new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"long"});return{sessions:t,newSession:a,loading:l,updateLoading:i,loadingSessions:o,editingSession:d,fetchSessions:c,addSession:u,editSession:m,updateSession:p,toggleSessionStatus:b,deleteSession:k,formatDate:L}}},ee=a(1241);const te=(0,ee.A)(Q,[["render",Z],["__scopeId","data-v-911408c8"]]);var ae=te}}]);
//# sourceMappingURL=94.56ea6129.js.map