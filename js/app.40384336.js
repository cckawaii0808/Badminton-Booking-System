(function(){"use strict";var e={1394:function(e,a,t){t.d(a,{$2:function(){return r.$2},Mc:function(){return d},Q4:function(){return r.Q4},db:function(){return l},j2:function(){return c}});var n=t(6400),s=t(7617),r=t(3831);const i={apiKey:"AIzaSyD1C9J2lnIdWyhcrOGFTn0enQmqN13Rms0",authDomain:"badminton-booking-system-api.firebaseapp.com",projectId:"badminton-booking-system-api",storageBucket:"badminton-booking-system-api.firebasestorage.app",messagingSenderId:"254455515689",appId:"1:254455515689:web:3be121b660e4ba103a2a38"},o=(0,n.Wp)(i),l=(0,s.aU)(o),c=(0,r.xI)(o),d=new r.LD("oidc.line");d.addScope("profile"),d.addScope("openid"),d.addScope("email"),d.setCustomParameters({prompt:"consent"})},8395:function(e,a,t){var n=t(5130),s=t(6768),r=t(4232);const i={id:"app"},o={class:"navbar navbar-expand-lg navbar-dark bg-primary"},l={class:"container"},c={class:"collapse navbar-collapse",id:"navbarMain"},d={class:"navbar-nav me-auto mb-2 mb-lg-0"},u={class:"nav-item"},m={class:"nav-item"},v={key:0,class:"nav-item"},p={key:1,class:"nav-item dropdown"},b={class:"dropdown-menu","aria-labelledby":"adminDropdown"},g={class:"d-flex"},f={class:"navbar-text me-3"},h={class:"bg-dark text-white mt-5 py-4"},k={class:"container"},L={class:"row"},y={class:"col-md-6 text-md-end"};function w(e,a,t,n,w,E){const x=(0,s.g2)("router-link"),_=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("header",null,[(0,s.Lk)("nav",o,[(0,s.Lk)("div",l,[(0,s.bF)(x,{class:"navbar-brand",to:"/"},{default:(0,s.k6)((()=>a[1]||(a[1]=[(0,s.eW)("羽球報名系統")]))),_:1}),a[11]||(a[11]=(0,s.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarMain","aria-controls":"navbarMain","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,s.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,s.Lk)("div",c,[(0,s.Lk)("ul",d,[(0,s.Lk)("li",u,[(0,s.bF)(x,{class:"nav-link",to:"/"},{default:(0,s.k6)((()=>a[2]||(a[2]=[(0,s.eW)("首頁")]))),_:1})]),(0,s.Lk)("li",m,[(0,s.bF)(x,{class:"nav-link",to:"/sessions"},{default:(0,s.k6)((()=>a[3]||(a[3]=[(0,s.eW)("場次列表")]))),_:1})]),n.isLoggedIn?((0,s.uX)(),(0,s.CE)("li",v,[(0,s.bF)(x,{class:"nav-link",to:"/dashboard"},{default:(0,s.k6)((()=>a[4]||(a[4]=[(0,s.eW)("個人儀表板")]))),_:1})])):(0,s.Q3)("",!0),n.isAdmin?((0,s.uX)(),(0,s.CE)("li",p,[a[8]||(a[8]=(0,s.Lk)("a",{class:"nav-link dropdown-toggle",href:"#",id:"adminDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," 管理功能 ",-1)),(0,s.Lk)("ul",b,[(0,s.Lk)("li",null,[(0,s.bF)(x,{class:"dropdown-item",to:"/admin/sessions"},{default:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.eW)("場次管理")]))),_:1})]),(0,s.Lk)("li",null,[(0,s.bF)(x,{class:"dropdown-item",to:"/admin/registrations"},{default:(0,s.k6)((()=>a[6]||(a[6]=[(0,s.eW)("報名管理")]))),_:1})]),(0,s.Lk)("li",null,[(0,s.bF)(x,{class:"dropdown-item",to:"/admin/blacklist"},{default:(0,s.k6)((()=>a[7]||(a[7]=[(0,s.eW)("黑名單管理")]))),_:1})])])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g,[n.isLoggedIn?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("span",f,(0,r.v_)(n.userDisplayName),1),(0,s.Lk)("button",{class:"btn btn-outline-light",onClick:a[0]||(a[0]=(...e)=>n.logout&&n.logout(...e))},"登出")],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.bF)(x,{to:"/login",class:"btn btn-outline-light me-2"},{default:(0,s.k6)((()=>a[9]||(a[9]=[(0,s.eW)("登入")]))),_:1}),(0,s.bF)(x,{to:"/register",class:"btn btn-light"},{default:(0,s.k6)((()=>a[10]||(a[10]=[(0,s.eW)("註冊")]))),_:1})],64))])])])])]),(0,s.Lk)("main",null,[(0,s.bF)(_)]),(0,s.Lk)("footer",h,[(0,s.Lk)("div",k,[(0,s.Lk)("div",L,[a[12]||(a[12]=(0,s.Lk)("div",{class:"col-md-6"},[(0,s.Lk)("h5",null,"羽球報名系統"),(0,s.Lk)("p",null,"簡單、快速的羽球場地和活動報名平台")],-1)),(0,s.Lk)("div",y,[(0,s.Lk)("p",null,"© "+(0,r.v_)((new Date).getFullYear())+" 羽球報名系統. 保留所有權利.",1)])])])])])}var E=t(144),x=t(3831),_=t(7617),A=t(1394),C={name:"App",setup(){const e=(0,s.WQ)("store"),a=(0,E.KR)(null),t=(0,E.KR)({}),n=(0,s.EW)((()=>!!a.value)),r=(0,s.EW)((()=>t.value&&"admin"===t.value.role)),i=(0,s.EW)((()=>t.value&&t.value.name?t.value.name:"用戶"));(0,s.sV)((()=>{if((0,x.hg)(A.j2,(async n=>{if(a.value=n,n)try{const a=await(0,_.x7)((0,_.H9)(A.db,"users",n.uid));a.exists()&&(t.value=a.data(),e.setAdmin("admin"===t.value.role))}catch(s){console.error("Error fetching user data:",s)}else t.value={},e.setAdmin(!1);e.setUser(n)})),"undefined"!==typeof document){const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js",e.integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p",e.crossOrigin="anonymous",document.head.appendChild(e)}}));const o=async()=>{try{await A.j2.signOut(),window.location.href="/"}catch(e){console.error("Error signing out:",e)}};return{isLoggedIn:n,isAdmin:r,userDisplayName:i,logout:o}}},S=t(1241);const W=(0,S.A)(C,[["render",w]]);var j=W,K=(t(8111),t(3579),t(1387));const R={class:"home"},O={class:"bg-primary text-white py-5 text-center"},q={class:"container"},F={class:"mt-4"},I={class:"py-5"},N={class:"container"},X={class:"row"},T={key:0,class:"col-12 text-center"},U={key:1,class:"col-12 text-center"},D={class:"card h-100"},P={class:"card-body"},Q={class:"card-title"},B={class:"card-subtitle mb-2 text-muted"},M={class:"card-text"};function V(e,a,t,n,i,o){const l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("header",O,[(0,s.Lk)("div",q,[a[3]||(a[3]=(0,s.Lk)("h1",{class:"display-4"},"羽球場地報名系統",-1)),a[4]||(a[4]=(0,s.Lk)("p",{class:"lead"},"輕鬆報名、管理羽球場地和活動",-1)),(0,s.Lk)("div",F,[n.currentUser?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(l,{key:0,to:"/login",class:"btn btn-light btn-lg me-2"},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.eW)("登入")]))),_:1})),n.currentUser?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(l,{key:1,to:"/register",class:"btn btn-outline-light btn-lg"},{default:(0,s.k6)((()=>a[1]||(a[1]=[(0,s.eW)("註冊")]))),_:1})),n.currentUser?((0,s.uX)(),(0,s.Wv)(l,{key:2,to:"/dashboard",class:"btn btn-light btn-lg"},{default:(0,s.k6)((()=>a[2]||(a[2]=[(0,s.eW)("進入儀表板")]))),_:1})):(0,s.Q3)("",!0)])])]),(0,s.Lk)("section",I,[(0,s.Lk)("div",N,[a[11]||(a[11]=(0,s.Lk)("h2",{class:"text-center mb-4"},"最新開放場次",-1)),(0,s.Lk)("div",X,[n.loading?((0,s.uX)(),(0,s.CE)("div",T,a[5]||(a[5]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"載入中...")],-1)]))):0===n.sessions.length?((0,s.uX)(),(0,s.CE)("div",U,a[6]||(a[6]=[(0,s.Lk)("p",null,"目前沒有開放的場次",-1)]))):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sessions,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"col-md-4 mb-4"},[(0,s.Lk)("div",D,[(0,s.Lk)("div",P,[(0,s.Lk)("h5",Q,(0,r.v_)(e.title),1),(0,s.Lk)("h6",B,(0,r.v_)(n.formatDate(e.date)),1),(0,s.Lk)("p",M,[a[7]||(a[7]=(0,s.Lk)("i",{class:"bi bi-geo-alt"},null,-1)),(0,s.eW)(" "+(0,r.v_)(e.location),1),a[8]||(a[8]=(0,s.Lk)("br",null,null,-1)),a[9]||(a[9]=(0,s.Lk)("i",{class:"bi bi-people"},null,-1)),(0,s.eW)(" "+(0,r.v_)(e.currentParticipants)+"/"+(0,r.v_)(e.maxParticipants)+" 人 ",1)]),(0,s.bF)(l,{to:`/registration/${e.id}`,class:"btn btn-primary"},{default:(0,s.k6)((()=>a[10]||(a[10]=[(0,s.eW)(" 立即報名 ")]))),_:2},1032,["to"])])])])))),128))])])]),a[12]||(a[12]=(0,s.Fv)('<section class="py-5 bg-light" data-v-086ca417><div class="container" data-v-086ca417><h2 class="text-center mb-4" data-v-086ca417>系統功能</h2><div class="row" data-v-086ca417><div class="col-md-4 mb-4" data-v-086ca417><div class="card h-100" data-v-086ca417><div class="card-body text-center" data-v-086ca417><i class="bi bi-calendar-check display-4 text-primary" data-v-086ca417></i><h3 class="mt-3" data-v-086ca417>簡易報名</h3><p data-v-086ca417>快速瀏覽開放場次，一鍵報名參加</p></div></div></div><div class="col-md-4 mb-4" data-v-086ca417><div class="card h-100" data-v-086ca417><div class="card-body text-center" data-v-086ca417><i class="bi bi-people display-4 text-primary" data-v-086ca417></i><h3 class="mt-3" data-v-086ca417>群組報名</h3><p data-v-086ca417>支援一次為多人報名，方便團體參加</p></div></div></div><div class="col-md-4 mb-4" data-v-086ca417><div class="card h-100" data-v-086ca417><div class="card-body text-center" data-v-086ca417><i class="bi bi-clock-history display-4 text-primary" data-v-086ca417></i><h3 class="mt-3" data-v-086ca417>歷史記錄</h3><p data-v-086ca417>查看個人報名歷史，追蹤繳費狀態</p></div></div></div></div></div></section>',1))])}t(1701);var J={name:"HomeView",setup(){const e=(0,E.KR)([]),a=(0,E.KR)(!0),t=(0,E.KR)(null);(0,s.sV)((async()=>{(0,x.hg)(A.j2,(e=>{t.value=e}));try{const a=(0,_.P)((0,_.rJ)(A.db,"sessions"),(0,_._M)("status","==","開放"),(0,_._M)("date",">=",new Date),(0,_.My)("date"),(0,_.AB)(6)),t=await(0,_.GG)(a);e.value=t.docs.map((e=>({id:e.id,...e.data(),date:e.data().date.toDate()})))}catch(n){console.error("Error fetching sessions:",n)}finally{a.value=!1}}));const n=e=>new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return{sessions:e,loading:a,currentUser:t,formatDate:n}}};const H=(0,S.A)(J,[["render",V],["__scopeId","data-v-086ca417"]]);var $=H;const G={class:"container mt-5"},z={class:"row justify-content-center"},Y={class:"col-md-6"},Z={class:"card"},ee={class:"card-body"},ae={key:0,class:"alert alert-danger"},te={key:1,class:"alert alert-success"},ne={class:"mb-3"},se={class:"mb-3"},re=["disabled"],ie={class:"mt-3 text-center"};function oe(e,a,t,i,o,l){const c=(0,s.g2)("LineLogin"),d=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",G,[(0,s.Lk)("div",z,[(0,s.Lk)("div",Y,[(0,s.Lk)("div",Z,[a[8]||(a[8]=(0,s.Lk)("div",{class:"card-header bg-primary text-white"},[(0,s.Lk)("h3",{class:"mb-0"},"登入系統")],-1)),(0,s.Lk)("div",ee,[i.error?((0,s.uX)(),(0,s.CE)("div",ae,(0,r.v_)(i.error),1)):(0,s.Q3)("",!0),i.loginSuccess?((0,s.uX)(),(0,s.CE)("div",te,"登入成功！正在轉跳...")):(0,s.Q3)("",!0),(0,s.bF)(c,{onLoginError:i.setError,onLoginSuccess:i.handleLoginSuccess},null,8,["onLoginError","onLoginSuccess"]),a[7]||(a[7]=(0,s.Lk)("div",{class:"mt-3 mb-3 text-center"},[(0,s.Lk)("div",{class:"divider d-flex align-items-center justify-content-center"},[(0,s.Lk)("span",{class:"divider-text"},"或使用電子郵件登入")])],-1)),(0,s.Lk)("form",{onSubmit:a[2]||(a[2]=(0,n.D$)(((...e)=>i.login&&i.login(...e)),["prevent"]))},[(0,s.Lk)("div",ne,[a[3]||(a[3]=(0,s.Lk)("label",{for:"email",class:"form-label"},"電子郵件",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[0]||(a[0]=e=>i.email=e),required:""},null,512),[[n.Jo,i.email]])]),(0,s.Lk)("div",se,[a[4]||(a[4]=(0,s.Lk)("label",{for:"password",class:"form-label"},"密碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":a[1]||(a[1]=e=>i.password=e),required:""},null,512),[[n.Jo,i.password]])]),(0,s.Lk)("button",{type:"submit",class:"btn btn-primary w-100",disabled:i.loading},(0,r.v_)(i.loading?"登入中...":"登入"),9,re),(0,s.Lk)("div",ie,[(0,s.Lk)("p",null,[a[6]||(a[6]=(0,s.eW)("還沒有帳號？ ")),(0,s.bF)(d,{to:"/register"},{default:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.eW)("註冊新帳號")]))),_:1})])])],32)])])])])])}t(4114);const le=["disabled"],ce={class:"d-flex align-items-center justify-content-center"};function de(e,a,t,n,i,o){return(0,s.uX)(),(0,s.CE)("button",{onClick:a[0]||(a[0]=(...e)=>n.loginWithLine&&n.loginWithLine(...e)),class:(0,r.C4)(["btn w-100 mt-3",{"btn-success":!t.isOutlined,"btn-outline-success":t.isOutlined}]),disabled:n.loading,style:{"background-color":"#06C755","border-color":"#06C755"}},[(0,s.Lk)("span",ce,[a[1]||(a[1]=(0,s.Lk)("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg",alt:"LINE Logo",style:{height:"24px","margin-right":"8px"}},null,-1)),(0,s.eW)(" "+(0,r.v_)(n.loading?"登入中...":"使用 LINE 登入"),1)])],10,le)}var ue={name:"LineLogin",props:{isOutlined:{type:Boolean,default:!1}},setup(e,{emit:a}){const t=(0,E.KR)(!1),n=(0,E.KR)(null),s=async()=>{t.value=!0,n.value=null;try{await(0,A.$2)(A.j2,A.Mc)}catch(e){console.error("LINE 登入失敗:",e),n.value="LINE 登入失敗，請稍後再試",a("login-error",n.value),t.value=!1}};return{loading:t,error:n,loginWithLine:s}}};const me=(0,S.A)(ue,[["render",de],["__scopeId","data-v-4c4d7e58"]]);var ve=me,pe={name:"LoginView",components:{LineLogin:ve},setup(){const e=(0,E.KR)(""),a=(0,E.KR)(""),t=(0,E.KR)(null),n=(0,E.KR)(!1),s=(0,E.KR)(!1),r=(0,K.rd)(),i=async()=>{n.value=!0,t.value=null;try{await(0,x.x9)(A.j2,e.value,a.value),r.push("/dashboard")}catch(s){console.error(s),t.value="登入失敗，請檢查您的電子郵件和密碼"}finally{n.value=!1}},o=e=>{t.value=e},l=()=>{s.value=!0,setTimeout((()=>{r.push("/dashboard")}),1e3)};return{email:e,password:a,error:t,loading:n,loginSuccess:s,login:i,setError:o,handleLoginSuccess:l}}};const be=(0,S.A)(pe,[["render",oe],["__scopeId","data-v-7e03b988"]]);var ge=be;const fe={class:"container mt-5"},he={class:"row justify-content-center"},ke={class:"col-md-6"},Le={class:"card"},ye={class:"card-body"},we={key:0,class:"alert alert-danger"},Ee={key:1,class:"alert alert-success"},xe={class:"mb-3"},_e={class:"mb-3"},Ae={class:"mb-3"},Ce={class:"mb-3"},Se={class:"mb-3"},We=["disabled"],je={class:"mt-3 text-center"};function Ke(e,a,t,i,o,l){const c=(0,s.g2)("LineLogin"),d=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",fe,[(0,s.Lk)("div",he,[(0,s.Lk)("div",ke,[(0,s.Lk)("div",Le,[a[15]||(a[15]=(0,s.Lk)("div",{class:"card-header bg-success text-white"},[(0,s.Lk)("h3",{class:"mb-0"},"註冊帳號")],-1)),(0,s.Lk)("div",ye,[i.error?((0,s.uX)(),(0,s.CE)("div",we,(0,r.v_)(i.error),1)):(0,s.Q3)("",!0),i.registrationSuccess?((0,s.uX)(),(0,s.CE)("div",Ee,"註冊成功！正在轉跳...")):(0,s.Q3)("",!0),(0,s.bF)(c,{onLoginError:i.setError,onLoginSuccess:i.handleLoginSuccess,isOutlined:""},null,8,["onLoginError","onLoginSuccess"]),a[14]||(a[14]=(0,s.Lk)("div",{class:"mt-3 mb-3 text-center"},[(0,s.Lk)("div",{class:"divider d-flex align-items-center justify-content-center"},[(0,s.Lk)("span",{class:"divider-text"},"或填寫註冊表單")])],-1)),(0,s.Lk)("form",{onSubmit:a[5]||(a[5]=(0,n.D$)(((...e)=>i.register&&i.register(...e)),["prevent"]))},[(0,s.Lk)("div",xe,[a[6]||(a[6]=(0,s.Lk)("label",{for:"name",class:"form-label"},"姓名",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>i.name=e),required:""},null,512),[[n.Jo,i.name]])]),(0,s.Lk)("div",_e,[a[7]||(a[7]=(0,s.Lk)("label",{for:"email",class:"form-label"},"電子郵件",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>i.email=e),required:""},null,512),[[n.Jo,i.email]])]),(0,s.Lk)("div",Ae,[a[8]||(a[8]=(0,s.Lk)("label",{for:"phone",class:"form-label"},"電話號碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":a[2]||(a[2]=e=>i.phone=e),required:""},null,512),[[n.Jo,i.phone]])]),(0,s.Lk)("div",Ce,[a[9]||(a[9]=(0,s.Lk)("label",{for:"password",class:"form-label"},"密碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":a[3]||(a[3]=e=>i.password=e),required:""},null,512),[[n.Jo,i.password]]),a[10]||(a[10]=(0,s.Lk)("div",{class:"form-text"},"密碼至少需要6個字元",-1))]),(0,s.Lk)("div",Se,[a[11]||(a[11]=(0,s.Lk)("label",{for:"confirmPassword",class:"form-label"},"確認密碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password",class:"form-control",id:"confirmPassword","onUpdate:modelValue":a[4]||(a[4]=e=>i.confirmPassword=e),required:""},null,512),[[n.Jo,i.confirmPassword]])]),(0,s.Lk)("button",{type:"submit",class:"btn btn-success w-100",disabled:i.loading},(0,r.v_)(i.loading?"註冊中...":"註冊"),9,We),(0,s.Lk)("div",je,[(0,s.Lk)("p",null,[a[13]||(a[13]=(0,s.eW)("已有帳號？ ")),(0,s.bF)(d,{to:"/login"},{default:(0,s.k6)((()=>a[12]||(a[12]=[(0,s.eW)("登入")]))),_:1})])])],32)])])])])])}var Re={name:"RegisterView",components:{LineLogin:ve},setup(){const e=(0,E.KR)(""),a=(0,E.KR)(""),t=(0,E.KR)(""),n=(0,E.KR)(""),s=(0,E.KR)(""),r=(0,E.KR)(null),i=(0,E.KR)(!1),o=(0,E.KR)(!1),l=(0,K.rd)(),c=async()=>{if(i.value=!0,r.value=null,n.value!==s.value)return r.value="密碼不一致",void(i.value=!1);if(n.value.length<6)return r.value="密碼至少需要6個字元",void(i.value=!1);try{const s=await(0,x.eJ)(A.j2,a.value,n.value);await(0,_.BN)((0,_.H9)(A.db,"users",s.user.uid),{name:e.value,email:a.value,phone:t.value,role:"user",isBlacklisted:!1,createdAt:new Date}),l.push("/dashboard")}catch(o){console.error(o),"auth/email-already-in-use"===o.code?r.value="此電子郵件已被使用":r.value="註冊失敗，請稍後再試"}finally{i.value=!1}},d=e=>{r.value=e},u=()=>{o.value=!0,setTimeout((()=>{l.push("/dashboard")}),1e3)};return{name:e,email:a,phone:t,password:n,confirmPassword:s,error:r,loading:i,registrationSuccess:o,register:c,setError:d,handleLoginSuccess:u}}};const Oe=(0,S.A)(Re,[["render",Ke],["__scopeId","data-v-7d829a9e"]]);var qe=Oe;const Fe={class:"container mt-5"},Ie={class:"row justify-content-center"},Ne={class:"col-md-6"},Xe={class:"card"},Te={class:"card-body text-center"},Ue={key:0,class:"my-5"},De={key:1,class:"alert alert-danger my-4"},Pe={key:2,class:"alert alert-success my-4"};function Qe(e,a,t,n,i,o){return(0,s.uX)(),(0,s.CE)("div",Fe,[(0,s.Lk)("div",Ie,[(0,s.Lk)("div",Ne,[(0,s.Lk)("div",Xe,[a[3]||(a[3]=(0,s.Lk)("div",{class:"card-header bg-primary text-white"},[(0,s.Lk)("h3",{class:"mb-0"},"LINE 登入處理中")],-1)),(0,s.Lk)("div",Te,[n.loading?((0,s.uX)(),(0,s.CE)("div",Ue,a[1]||(a[1]=[(0,s.Lk)("div",{class:"spinner-border text-primary mb-3",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,s.Lk)("p",null,"正在處理您的登入請求，請稍候...",-1)]))):n.error?((0,s.uX)(),(0,s.CE)("div",De,[(0,s.Lk)("p",null,(0,r.v_)(n.error),1),(0,s.Lk)("button",{class:"btn btn-outline-primary mt-2",onClick:a[0]||(a[0]=(...e)=>n.goToLogin&&n.goToLogin(...e))},"返回登入頁面")])):n.success?((0,s.uX)(),(0,s.CE)("div",Pe,a[2]||(a[2]=[(0,s.Lk)("p",null,"登入成功！正在將您轉至主頁...",-1)]))):(0,s.Q3)("",!0)])])])])])}var Be={name:"LineCallback",setup(){const e=(0,E.KR)(!0),a=(0,E.KR)(null),t=(0,E.KR)(!1),n=(0,K.rd)(),r=()=>{n.push("/login")};return(0,s.sV)((async()=>{try{const e=await(0,A.Q4)(A.j2);if(e){const a=e.user,s=await(0,_.x7)((0,_.H9)(A.db,"users",a.uid));s.exists()?await(0,_.BN)((0,_.H9)(A.db,"users",a.uid),{lastLogin:(0,_.O5)()},{merge:!0}):await(0,_.BN)((0,_.H9)(A.db,"users",a.uid),{email:a.email,displayName:a.displayName,photoURL:a.photoURL,provider:"line",createdAt:(0,_.O5)(),lastLogin:(0,_.O5)()}),t.value=!0,setTimeout((()=>{n.push("/dashboard")}),1500)}else n.push("/login")}catch(s){console.error("LINE 回調處理錯誤:",s),a.value="登入處理失敗，請稍後再試"}finally{e.value=!1}})),{loading:e,error:a,success:t,goToLogin:r}}};const Me=(0,S.A)(Be,[["render",Qe],["__scopeId","data-v-1b9e5c58"]]);var Ve=Me;const Je=[{path:"/",name:"home",component:$},{path:"/login",name:"login",component:ge},{path:"/register",name:"register",component:qe},{path:"/__/auth/handler",name:"line-callback",component:Ve},{path:"/dashboard",name:"dashboard",component:()=>t.e(326).then(t.bind(t,2326)),meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:()=>t.e(50).then(t.bind(t,7050)),meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/sessions",name:"admin-sessions",component:()=>t.e(94).then(t.bind(t,5094)),meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/registrations",name:"admin-registrations",component:()=>t.e(172).then(t.bind(t,4172)),meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/blacklist",name:"admin-blacklist",component:()=>t.e(532).then(t.bind(t,7532)),meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/sessions",name:"sessions",component:()=>t.e(621).then(t.bind(t,8621))},{path:"/registration/:id",name:"registration",component:()=>t.e(218).then(t.bind(t,2218)),meta:{requiresAuth:!0}},{path:"/registration-success",name:"registration-success",component:()=>t.e(688).then(t.bind(t,4688)),meta:{requiresAuth:!0}},{path:"/profile",name:"profile",component:()=>t.e(146).then(t.bind(t,1146)),meta:{requiresAuth:!0}}],He=(0,K.aE)({history:(0,K.LA)("/Badminton-Booking-System/"),routes:Je});He.beforeEach((async(e,a,t)=>{const n=e.matched.some((e=>e.meta.requiresAuth)),s=e.matched.some((e=>e.meta.requiresAdmin)),r=A.j2.currentUser;if(n&&!r)t("/login");else if(s&&r)try{const e=await(0,_.x7)((0,_.H9)(A.db,"users",r.uid)),a=e.exists()&&"admin"===e.data().role;a?t():(alert("您沒有管理員權限"),t("/dashboard"))}catch(i){console.error("Error checking admin status:",i),t("/dashboard")}else t()}));var $e=He;const Ge=(0,E.Kh)({user:null,isAdmin:!1}),ze={isLoggedIn:()=>!!Ge.user,isAdmin:()=>Ge.isAdmin,currentUser:()=>Ge.user},Ye={setUser(e){Ge.user=e},setAdmin(e){Ge.isAdmin=e},logout(){Ge.user=null,Ge.isAdmin=!1}};var Ze={state:Ge,getters:ze,...Ye};const ea=(0,n.Ef)(j);ea.provide("store",Ze),ea.use($e),ea.mount("#app")}},a={};function t(n){var s=a[n];if(void 0!==s)return s.exports;var r=a[n]={exports:{}};return e[n].call(r.exports,r,r.exports,t),r.exports}t.m=e,function(){var e=[];t.O=function(a,n,s,r){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],s=e[d][1],r=e[d][2];for(var o=!0,l=0;l<n.length;l++)(!1&r||i>=r)&&Object.keys(t.O).every((function(e){return t.O[e](n[l])}))?n.splice(l--,1):(o=!1,r<i&&(i=r));if(o){e.splice(d--,1);var c=s();void 0!==c&&(a=c)}}return a}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,s,r]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(a,n){return t.f[n](e,a),a}),[]))}}(),function(){t.u=function(e){return"js/"+e+"."+{50:"2007fdf6",94:"56ea6129",146:"a869c831",172:"ae01afd7",218:"e23b7b09",326:"78d685d8",532:"66a73d07",621:"c77f9aba",688:"b2063339"}[e]+".js"}}(),function(){t.miniCssF=function(e){return"css/"+e+"."+{50:"15e7ca86",94:"1961d584",146:"c478df68",172:"358c3856",218:"501eed75",326:"ec69ac92",532:"86fcbaeb",621:"7ac5d451",688:"14f9394e"}[e]+".css"}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={},a="badminton-registration:";t.l=function(n,s,r,i){if(e[n])e[n].push(s);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==a+r){o=u;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,t.nc&&o.setAttribute("nonce",t.nc),o.setAttribute("data-webpack",a+r),o.src=n),e[n]=[s];var m=function(a,t){o.onerror=o.onload=null,clearTimeout(v);var s=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((function(e){return e(t)})),a)return a(t)},v=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/Badminton-Booking-System/"}(),function(){if("undefined"!==typeof document){var e=function(e,a,n,s,r){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",t.nc&&(i.nonce=t.nc);var o=function(t){if(i.onerror=i.onload=null,"load"===t.type)s();else{var n=t&&t.type,o=t&&t.target&&t.target.href||a,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+o+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=o,i.parentNode&&i.parentNode.removeChild(i),r(l)}};return i.onerror=i.onload=o,i.href=a,n?n.parentNode.insertBefore(i,n.nextSibling):document.head.appendChild(i),i},a=function(e,a){for(var t=document.getElementsByTagName("link"),n=0;n<t.length;n++){var s=t[n],r=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(r===e||r===a))return s}var i=document.getElementsByTagName("style");for(n=0;n<i.length;n++){s=i[n],r=s.getAttribute("data-href");if(r===e||r===a)return s}},n=function(n){return new Promise((function(s,r){var i=t.miniCssF(n),o=t.p+i;if(a(i,o))return s();e(n,o,null,s,r)}))},s={524:0};t.f.miniCss=function(e,a){var t={50:1,94:1,146:1,172:1,218:1,326:1,532:1,621:1,688:1};s[e]?a.push(s[e]):0!==s[e]&&t[e]&&a.push(s[e]=n(e).then((function(){s[e]=0}),(function(a){throw delete s[e],a})))}}}(),function(){var e={524:0};t.f.j=function(a,n){var s=t.o(e,a)?e[a]:void 0;if(0!==s)if(s)n.push(s[2]);else{var r=new Promise((function(t,n){s=e[a]=[t,n]}));n.push(s[2]=r);var i=t.p+t.u(a),o=new Error,l=function(n){if(t.o(e,a)&&(s=e[a],0!==s&&(e[a]=void 0),s)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;o.message="Loading chunk "+a+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,s[1](o)}};t.l(i,l,"chunk-"+a,a)}},t.O.j=function(a){return 0===e[a]};var a=function(a,n){var s,r,i=n[0],o=n[1],l=n[2],c=0;if(i.some((function(a){return 0!==e[a]}))){for(s in o)t.o(o,s)&&(t.m[s]=o[s]);if(l)var d=l(t)}for(a&&a(n);c<i.length;c++)r=i[c],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(d)},n=self["webpackChunkbadminton_registration"]=self["webpackChunkbadminton_registration"]||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))}();var n=t.O(void 0,[504],(function(){return t(8395)}));n=t.O(n)})();
//# sourceMappingURL=app.40384336.js.map